<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Business Finder - Local Business Finder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Babel Standalone for in-browser JSX/TS compilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      body {
        font-family: 'Inter', sans-serif;
      }
      .console-scrollbar::-webkit-scrollbar {
        width: 8px;
      }
      .console-scrollbar::-webkit-scrollbar-track {
        background: #1e1e1e;
      }
      .console-scrollbar::-webkit-scrollbar-thumb {
        background: #4b5563;
        border-radius: 4px;
      }
      .console-scrollbar::-webkit-scrollbar-thumb:hover {
        background: #6b7280;
      }
    </style>
  <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/",
    "lucide-react": "https://esm.sh/lucide-react@^0.561.0"
  }
}
</script>
</head>
  <body class="bg-slate-50 text-slate-900 antialiased">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
      import React, { useState, useCallback, useEffect, useRef } from 'https://esm.sh/react@18.2.0';
      import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';
      import { 
        Search, MapPin, SlidersHorizontal, Play, RefreshCw, AlertTriangle,
        Terminal, ShieldAlert, CheckCircle, Star, ExternalLink, Download, Globe
      } from 'https://esm.sh/lucide-react@0.294.0';

      // --- Types (Kept for reference, stripped by Babel) ---
      
      const AppStatus = {
        IDLE: 'IDLE',
        SCANNING: 'SCANNING',
        COMPLETED: 'COMPLETED',
        PAUSED: 'PAUSED'
      };

      // --- Constants ---
      
      const BUSINESS_TYPES = [
        "Plumbing", "Bakery", "Auto Repair", "Dentist", "Florist", 
        "Consulting", "Law Firm", "Real Estate", "HVAC", "Diner",
        "Barbershop", "Dry Cleaners", "Landscaping", "Hardware Store"
      ];

      const BUSINESS_PREFIXES = [
        "Joe's", "City", "Downtown", "Elite", "Pro", "Family", "Star", 
        "Best", "Quick", "Local", "Main Street", "Corner", "Golden"
      ];

      const STREET_NAMES = [
        "Main St", "Broadway", "Park Ave", "Oak Ln", "Maple Dr", 
        "Cedar Blvd", "Washington St", "Highland Ave", "Elm St"
      ];

      const generatePhone = () => {
        const area = Math.floor(Math.random() * 800) + 200;
        const pre = Math.floor(Math.random() * 900) + 100;
        const line = Math.floor(Math.random() * 9000) + 1000;
        return `(${area}) ${pre}-${line}`;
      };

      // --- Services ---

      const seededRandom = (seed) => {
        const x = Math.sin(seed++) * 10000;
        return x - Math.floor(x);
      };

      const generateMockBusiness = (index, location) => {
        const seed = location.length + index + Date.now();
        const rand = () => seededRandom(seed + Math.random());
        
        const type = BUSINESS_TYPES[Math.floor(rand() * BUSINESS_TYPES.length)];
        const prefix = BUSINESS_PREFIXES[Math.floor(rand() * BUSINESS_PREFIXES.length)];
        const street = STREET_NAMES[Math.floor(rand() * STREET_NAMES.length)];
        const num = Math.floor(rand() * 9000) + 100;
        
        const hasWebsite = rand() > 0.4;
        
        let rating = 3.0 + (rand() * 2.0); 
        if (rand() > 0.9) rating = 1.5 + (rand() * 2.0);
        
        const name = `${prefix} ${type}`;
        const sanitizedName = name.replace(/[^a-zA-Z]/g, "").toLowerCase();

        return {
          id: `biz-${index}-${Date.now()}`,
          name: name,
          type: type,
          rating: parseFloat(rating.toFixed(1)),
          reviews: Math.floor(rand() * 150) + 1,
          phone: generatePhone(),
          address: `${num} ${street}, ${location}`,
          postalCode: `${Math.floor(rand() * 90000) + 10000}`,
          mapsUrl: `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(`${name} ${location}`)}`,
          hasWebsite: hasWebsite,
          website: hasWebsite ? `https://www.${sanitizedName}.com` : undefined
        };
      };

      const sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms));

      // --- Components ---

      const ConsoleLog = ({ logs }) => {
        const endRef = useRef(null);

        useEffect(() => {
          endRef.current?.scrollIntoView({ behavior: 'smooth' });
        }, [logs]);

        const getIcon = (type) => {
          switch (type) {
            case 'success': return <CheckCircle size={14} className="text-green-500" />;
            case 'warning': return <ShieldAlert size={14} className="text-yellow-500" />;
            case 'error': return <ShieldAlert size={14} className="text-red-500" />;
            case 'process': return <Search size={14} className="text-blue-400" />;
            default: return <span className="w-3.5 h-3.5 block rounded-full bg-slate-600" />;
          }
        };

        const getColor = (type) => {
          switch (type) {
            case 'success': return 'text-green-400';
            case 'warning': return 'text-yellow-400';
            case 'error': return 'text-red-400';
            case 'process': return 'text-blue-300';
            default: return 'text-slate-300';
          }
        };

        return (
          <div className="bg-[#1e1e1e] rounded-lg shadow-xl overflow-hidden flex flex-col h-[300px] border border-slate-700">
            <div className="bg-[#2d2d2d] px-4 py-2 flex items-center justify-between border-b border-slate-700">
              <div className="flex items-center gap-2">
                <Terminal size={16} className="text-slate-400" />
                <span className="text-xs font-mono text-slate-300">Scanner Output</span>
              </div>
              <div className="flex gap-1.5">
                <div className="w-3 h-3 rounded-full bg-red-500/20 border border-red-500/50"></div>
                <div className="w-3 h-3 rounded-full bg-yellow-500/20 border border-yellow-500/50"></div>
                <div className="w-3 h-3 rounded-full bg-green-500/20 border border-green-500/50"></div>
              </div>
            </div>
            <div className="p-4 overflow-y-auto font-mono text-xs space-y-2 flex-1 console-scrollbar">
              {logs.length === 0 && (
                <div className="text-slate-500 italic">Waiting to start scan...</div>
              )}
              {logs.map((log) => (
                <div key={log.id} className="flex items-start gap-2 animate-in fade-in slide-in-from-left-2 duration-300">
                  <span className="text-slate-500 whitespace-nowrap">
                    [{log.timestamp.toLocaleTimeString([], { hour12: false, hour: '2-digit', minute:'2-digit', second:'2-digit' })}]
                  </span>
                  <div className="mt-0.5">{getIcon(log.type)}</div>
                  <span className={`${getColor(log.type)} break-all`}>{log.message}</span>
                </div>
              ))}
              <div ref={endRef} />
            </div>
          </div>
        );
      };

      const ResultsTable = ({ leads }) => {
        const downloadCSV = () => {
          if (leads.length === 0) return;
          
          const headers = ["Company Name", "Rating", "Reviews", "Phone", "Address", "Postal Code", "Maps URL", "Website Status"];
          const csvContent = [
            headers.join(","),
            ...leads.map(lead => [
              `"${lead.name}"`,
              lead.rating,
              lead.reviews,
              `"${lead.phone}"`,
              `"${lead.address}"`,
              `"${lead.postalCode}"`,
              `"${lead.mapsUrl}"`,
              lead.hasWebsite ? lead.website : "No Website"
            ].join(","))
          ].join("\n");

          const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
          const url = URL.createObjectURL(blob);
          const link = document.createElement("a");
          link.setAttribute("href", url);
          link.setAttribute("download", `leads_export_${new Date().toISOString().slice(0, 10)}.csv`);
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        };

        if (leads.length === 0) {
          return (
            <div className="bg-white rounded-lg border border-slate-200 h-64 flex flex-col items-center justify-center text-slate-400">
              <MapPin size={48} className="mb-4 text-slate-200" />
              <p>No qualified leads found yet.</p>
              <p className="text-sm">Start a scan to begin populating this table.</p>
            </div>
          );
        }

        return (
          <div className="bg-white rounded-lg border border-slate-200 shadow-sm overflow-hidden flex flex-col">
            <div className="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50">
              <div>
                <h3 className="font-semibold text-slate-800">Qualified Leads</h3>
                <p className="text-sm text-slate-500">{leads.length} businesses found matching criteria</p>
              </div>
              <button 
                onClick={downloadCSV}
                className="flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-medium rounded-md transition-colors"
              >
                <Download size={16} />
                Export CSV
              </button>
            </div>
            <div className="overflow-x-auto">
              <table className="w-full text-left text-sm text-slate-600">
                <thead className="bg-slate-50 text-slate-500 font-medium border-b border-slate-200">
                  <tr>
                    <th className="px-6 py-3">Business Name</th>
                    <th className="px-6 py-3">Rating</th>
                    <th className="px-6 py-3">Details</th>
                    <th className="px-6 py-3">Address</th>
                    <th className="px-6 py-3">Action</th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-slate-100">
                  {leads.map((lead) => (
                    <tr key={lead.id} className="hover:bg-slate-50 transition-colors">
                      <td className="px-6 py-4">
                        <div className="font-medium text-slate-900">{lead.name}</div>
                        <div className="text-xs text-slate-500">{lead.type}</div>
                      </td>
                      <td className="px-6 py-4">
                        <div className="flex items-center gap-1">
                          <Star size={14} className="fill-orange-400 text-orange-400" />
                          <span className="font-semibold text-slate-700">{lead.rating}</span>
                          <span className="text-slate-400 text-xs">({lead.reviews})</span>
                        </div>
                      </td>
                      <td className="px-6 py-4">
                        <div className="flex flex-col gap-1">
                          <span className="text-slate-700">{lead.phone}</span>
                          {lead.hasWebsite && lead.website ? (
                             <a href={lead.website} target="_blank" rel="noopener noreferrer" className="inline-flex items-center gap-1 text-xs text-blue-600 hover:underline">
                               <Globe size={12} /> Website
                             </a>
                          ) : (
                            <span className="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800 w-fit">
                              No Website
                            </span>
                          )}
                        </div>
                      </td>
                      <td className="px-6 py-4 max-w-xs truncate" title={lead.address}>
                        {lead.address}
                      </td>
                      <td className="px-6 py-4">
                        <a 
                          href={lead.mapsUrl} 
                          target="_blank" 
                          rel="noopener noreferrer"
                          className="text-indigo-600 hover:text-indigo-800 hover:underline flex items-center gap-1 text-xs font-medium"
                        >
                          View Map <ExternalLink size={12} />
                        </a>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
        );
      };

      // --- App ---

      function App() {
        const [status, setStatus] = useState(AppStatus.IDLE);
        const [params, setParams] = useState({
          location: '',
          quantity: 10,
          minReviews: 0,
          maxDistance: 5,
          ratingThreshold: 4.0,
          requireNoWebsite: true
        });
        
        const [leads, setLeads] = useState([]);
        const [logs, setLogs] = useState([]);
        const [progress, setProgress] = useState(0);

        const addLog = useCallback((message, type = 'info') => {
          setLogs(prev => [...prev, {
            id: Math.random().toString(36),
            timestamp: new Date(),
            message,
            type
          }]);
        }, []);

        const handleStartScan = async () => {
          if (!params.location) {
            addLog("Error: Location is required.", 'error');
            return;
          }

          setStatus(AppStatus.SCANNING);
          setLeads([]);
          setLogs([]);
          setProgress(0);
          addLog(`Initializing search in ${params.location}...`, 'process');
          addLog(`Criteria: < ${params.ratingThreshold} Stars, ${params.requireNoWebsite ? 'NO Website' : 'Any Website'}.`, 'info');

          let leadsFound = 0;
          let checkedCount = 0;
          
          try {
            while (leadsFound < params.quantity) {
              checkedCount++;
              
              if (checkedCount > params.quantity * 15) {
                  addLog("Max search attempts reached. Stopping.", 'warning');
                  break;
              }

              await sleep(Math.random() * 800 + 200); 

              const candidate = generateMockBusiness(checkedCount, params.location);
              addLog(`Scanning "${candidate.name}"...`, 'process');

              if (params.requireNoWebsite && candidate.hasWebsite) {
                addLog(`  -> Skipped: Website detected.`, 'info');
                continue; 
              }

              if (candidate.rating >= params.ratingThreshold) {
                addLog(`  -> Skipped: Rating ${candidate.rating} is too high.`, 'info');
                continue;
              }

              if (candidate.reviews < params.minReviews) {
                addLog(`  -> Skipped: Only ${candidate.reviews} reviews (Min: ${params.minReviews}).`, 'info');
                continue;
              }

              setLeads(prev => [...prev, candidate]);
              leadsFound++;
              addLog(`  -> MATCH FOUND! ${candidate.name} (${candidate.rating} stars)`, 'success');
              
              const newProgress = Math.round((leadsFound / params.quantity) * 100);
              setProgress(newProgress);
            }
            
            addLog(`Scan complete. Found ${leadsFound} qualified leads.`, 'success');
          } catch (error) {
            addLog(`Scan failed: ${error}`, 'error');
          } finally {
            setStatus(AppStatus.COMPLETED);
          }
        };

        const isScanning = status === AppStatus.SCANNING;

        return (
          <div className="min-h-screen bg-slate-50 flex flex-col">
            <header className="bg-white border-b border-slate-200 sticky top-0 z-10 shadow-sm">
              <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
                <div className="flex items-center gap-2">
                  <div className="bg-indigo-600 p-2 rounded-lg text-white">
                    <Search size={20} />
                  </div>
                  <div>
                    <h1 className="text-xl font-bold text-slate-900 tracking-tight">Business Finder</h1>
                    <span className="text-xs text-slate-500 font-medium">Easy Business Finder</span>
                  </div>
                </div>
                <div className="flex items-center gap-4">
                   {status === AppStatus.COMPLETED && (
                      <span className="flex items-center gap-1.5 px-3 py-1 rounded-full bg-green-100 text-green-700 text-xs font-bold">
                         <span className="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                         Scan Complete
                      </span>
                   )}
                </div>
              </div>
            </header>

            <main className="flex-1 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full gap-8 grid grid-cols-1 lg:grid-cols-12">
              <div className="lg:col-span-4 space-y-6">
                <div className="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                  <div className="flex items-center gap-2 mb-6">
                    <SlidersHorizontal className="text-indigo-600" size={20} />
                    <h2 className="font-semibold text-slate-800">Search Configuration</h2>
                  </div>

                  <div className="space-y-4">
                    <div className="space-y-1.5">
                      <label className="text-sm font-medium text-slate-700">Target Location <span className="text-red-500">*</span></label>
                      <div className="relative">
                        <MapPin className="absolute left-3 top-2.5 text-slate-400" size={18} />
                        <input
                          type="text"
                          disabled={isScanning}
                          value={params.location}
                          onChange={(e) => setParams(prev => ({ ...prev, location: e.target.value }))}
                          placeholder="e.g. Austin, TX"
                          className="w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all disabled:bg-slate-50 disabled:text-slate-500"
                        />
                      </div>
                    </div>

                    <div className="space-y-1.5">
                      <label className="text-sm font-medium text-slate-700">Lead Quantity</label>
                      <input
                        type="number"
                        min={1}
                        max={100}
                        disabled={isScanning}
                        value={params.quantity}
                        onChange={(e) => setParams(prev => ({ ...prev, quantity: parseInt(e.target.value) || 0 }))}
                        className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none disabled:bg-slate-50"
                      />
                    </div>

                    <div className="border-t border-slate-100 my-4 pt-4">
                      <p className="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-4">Filters</p>
                      
                      <div className="flex items-start gap-2 mb-4">
                        <input
                          id="requireNoWebsite"
                          type="checkbox"
                          disabled={isScanning}
                          checked={params.requireNoWebsite}
                          onChange={(e) => setParams(prev => ({ ...prev, requireNoWebsite: e.target.checked }))}
                          className="mt-1 w-4 h-4 text-indigo-600 border-slate-300 rounded focus:ring-indigo-500"
                        />
                        <label htmlFor="requireNoWebsite" className="text-sm text-slate-600">
                          <span className="font-medium text-slate-700 block">Require "No Website"</span>
                          <span className="text-xs text-slate-500">Only find businesses without a listed website</span>
                        </label>
                      </div>

                      <div className="grid grid-cols-2 gap-4">
                        <div className="space-y-1.5">
                          <label className="text-xs font-medium text-slate-600">Max Rating</label>
                          <input
                            type="number"
                            step="0.1"
                            max="5"
                            disabled={isScanning}
                            value={params.ratingThreshold}
                            onChange={(e) => setParams(prev => ({ ...prev, ratingThreshold: parseFloat(e.target.value) }))}
                            className="w-full px-3 py-2 text-sm border border-slate-300 rounded-lg focus:ring-1 focus:ring-indigo-500"
                          />
                        </div>
                         <div className="space-y-1.5">
                          <label className="text-xs font-medium text-slate-600">Min Reviews</label>
                          <input
                            type="number"
                            min="0"
                            disabled={isScanning}
                            value={params.minReviews}
                            onChange={(e) => setParams(prev => ({ ...prev, minReviews: parseInt(e.target.value) }))}
                            className="w-full px-3 py-2 text-sm border border-slate-300 rounded-lg focus:ring-1 focus:ring-indigo-500"
                          />
                        </div>
                      </div>
                      
                       <div className="space-y-1.5 mt-4">
                          <label className="text-xs font-medium text-slate-600">Search Radius</label>
                          <select 
                            disabled={isScanning}
                            value={params.maxDistance}
                            onChange={(e) => setParams(prev => ({ ...prev, maxDistance: parseInt(e.target.value) }))}
                            className="w-full px-3 py-2 text-sm border border-slate-300 rounded-lg focus:ring-1 focus:ring-indigo-500 bg-white"
                          >
                            <option value={5}>5 Miles</option>
                            <option value={10}>10 Miles</option>
                            <option value={25}>25 Miles</option>
                            <option value={50}>50 Miles</option>
                          </select>
                        </div>
                    </div>

                    <button
                      onClick={handleStartScan}
                      disabled={isScanning}
                      className={`w-full flex items-center justify-center gap-2 py-3 rounded-lg font-semibold text-white transition-all shadow-md transform active:scale-95 ${
                        isScanning 
                          ? 'bg-slate-400 cursor-not-allowed' 
                          : 'bg-indigo-600 hover:bg-indigo-700 hover:shadow-lg'
                      }`}
                    >
                      {isScanning ? (
                        <>
                          <RefreshCw className="animate-spin" size={20} />
                          Scanning Map...
                        </>
                      ) : (
                        <>
                          <Play size={20} className="fill-current" />
                          Start Search
                        </>
                      )}
                    </button>

                    <div className="bg-yellow-50 border border-yellow-100 rounded-md p-3 flex gap-2 items-start mt-4">
                      <AlertTriangle className="text-yellow-600 shrink-0 mt-0.5" size={14} />
                      <p className="text-xs text-yellow-800 leading-tight">
                        <strong>Simulation Mode:</strong> As per request (no API key), this tool simulates the scraping process logic using the specified parameters.
                      </p>
                    </div>
                  </div>
                </div>

                {status !== AppStatus.IDLE && (
                  <div className="bg-white rounded-xl shadow-sm border border-slate-200 p-6 animate-in fade-in slide-in-from-bottom-4 duration-500">
                     <div className="flex justify-between items-end mb-2">
                       <span className="text-sm font-medium text-slate-700">Progress</span>
                       <span className="text-2xl font-bold text-indigo-600">{progress}%</span>
                     </div>
                     <div className="w-full bg-slate-100 rounded-full h-2.5 overflow-hidden">
                       <div 
                          className="bg-indigo-600 h-2.5 rounded-full transition-all duration-300 ease-out" 
                          style={{ width: `${progress}%` }}
                        ></div>
                     </div>
                     <p className="text-xs text-slate-400 mt-2 text-center">
                       {status === AppStatus.COMPLETED ? 'Job Finished' : 'Identifying qualified businesses...'}
                     </p>
                  </div>
                )}
              </div>

              <div className="lg:col-span-8 flex flex-col gap-6">
                <ConsoleLog logs={logs} />
                <ResultsTable leads={leads} />
              </div>

            </main>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>